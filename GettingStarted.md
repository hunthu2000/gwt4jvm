This page explains how to load test GWT applications with the **gwt4jvm** framework. The instructions has been written for projects that use Maven, but it shouldn't be too difficult to adopt them in any other build system.

### Setting Up ###

The **gwt4jvm** framework highly relies on the code of GWT application and the one that is generated by GWT during compilation. To make this code being compiled into classes and deployed as separate Maven artifact, you should slightly modify the POM of your GWT application. Here is step-by-step guide:

1. Make `gwt4jvm-overrides` the first dependency in the POM to enable GWT-RPC generators to create JVM-compatible service proxies:

```
<!-- This dependency should be the first dependency in the POM! -->
<dependency>
    <groupId>com.mind.gwt4jvm</groupId>
    <artifactId>gwt4jvm-overrides</artifactId>
    <scope>provided</scope>
</dependency>
```

2. Use `maven-compiler-plugin` in conjunction with `build-helper-maven-plugin` to make source code created by GWT generators being compiled into classes as well:

```
<!-- This two plugins should come after `gwt-maven-plugin` definition! -->
<plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>build-helper-maven-plugin</artifactId>
    <executions>
        <execution>
            <id>add-gwt-generated-sources</id>
            <phase>prepare-package</phase>
            <goals>
                <goal>add-source</goal>
            </goals>
            <configuration>
                <sources>
                    <source>${project.build.directory}/.generated</source>
                </sources>
            </configuration>
        </execution>
    </executions>
</plugin>
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <executions>
        <execution>
            <id>compile-gwt-generated-sources</id>
            <goals>
                <goal>compile</goal>
            </goals>
            <phase>prepare-package</phase>
            <configuration>
                <excludes>
                    <exclude>**/AnnotationTypeMismatchException_FieldSerializer.java</exclude>
                    <exclude>**/AnnotationFormatError_FieldSerializer.java</exclude>
                </excludes>
            </configuration>
        </execution>
    </executions>
</plugin>
```

3. Set `attachClasses` option of `maven-war-plugin` to `true` value to make it produce and deploy an additional JAR artifact containing all the classes of your GWT application:

```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <configuration>
        <!-- This option forces `maven-war-plugin` to produce and deploy an “attached” artifact with all the classes -->
        <attachClasses>true</attachClasses>
    </configuration>
</plugin>
```

Now rebuild and reinstall GWT application (with `mvn install`) and if you did everything right there should be a new artifact (ending with `-classes.jar`) installed to local Maven repository.

### Your First Load Test ###

1. Create a new Maven project based on `gwt4jvm-archetype-quickstart` archetype:

```
mvn archetype:generate -DarchetypeGroupId=com.mind.gwt4jvm -DarchetypeArtifactId=gwt4jvm-archetype-quickstart
```

2. Add to a POM of a newly generated project a dependency on the “additional JAR artifact” (see [Setting Up](#Setting_Up.md) section for instructions how to produce it):

```
<dependency>
    <groupId><!-- Replace with ‘groupId’ of “additional JAR artifact” --></groupId>
    <artifactId><!--Replace with ‘artifactId’ of “additional JAR artifact” --></artifactId>
    <classifier>classes</classifier>
    <scope>test</scope>
</dependency>
```

3. Find `SimpleLoadTest.java` and replace its `onModuleLoad` method with a chain of GWT-RPCs that simulates some usage scenario (see [TypicalScenarioTest.java](http://code.google.com/p/gwt4jvm/source/browse/gwt4jvm-sample/src/test/java/com/mind/mc/TypicalScenarioTest.java) if you need an example). Don’t forget to insert `Context.getCurrentContext().getClient().success()` and `Context.getCurrentContext().getClient().failure()` at each point where `SimpleLoadTest` should be terminated with success or failure respectively.

4. When you are done build and run `SimpleLoadTest`:

```
mvn test -DconcurrentUsers=100             \
         -DrampUpSeconds=10                \
         -DtestDurationSeconds=30          \
         -Dtest=SimpleLoadTest             \
         -DmoduleBaseURL=<MODULE_BASE_URL>
```

And it will ramp up the load of the hundred concurrently working instances of `SimpleLoadTest` in 10 seconds and will maintain it for half a minute stressing Java backend which address is derived from the specified `MODULE_BASE_URL`.